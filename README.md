# 画像一致プログラム
## 概要
金属表面の実験前後の形状を比較するため、2つの画像を一致させるプログラムを開発しました。これにより実験による表面の変化を正確に観測することが可能になりました。

## 実験テーマとプログラム開発の経緯
 私の研究テーマは「超精密切削における切り屑生成メカニズムの解明」です。切削は金属を削り、形を整える加工方法であり、例えば飛行機の胴体はアルミニウムを切削して筒状に仕上げています。特に、超精密切削では金属をナノメートル単位の極めて薄い層で削ることができ、これは顕微鏡のレンズなど高精度を求められる光学部品の製造に利用されています。

　しかし、ナノメートルの薄さで金属を削る場合、切り屑が排出されず、狙った寸法通りに加工できないという問題が生じます。例えるなら、粘土に指を押し込むと、その部分が周囲に押し広げられ変形するように、ナノメートル単位の加工では金属でも同様の現象が起こります。このような微小な材料の変形は非常に観察が難しいため、実験前後の表面変化を捉えるための画像一致プログラムを開発しました。

　現在、このプログラムを活用して材料の変形を観察できるようになったことで、摩擦状態や切削速度といった加工条件が材料の変形に与える影響についての研究を進めています。

## 画像の加工手順
### 顕微鏡観察
実験前後の表面画像を作成する。表面画像は以下のようになる。  
実験後の画像のみに見られる。中央の黒い箇所は実験により削った部分である。
<img src="https://github.com/user-attachments/assets/1cd0ffa2-9e6c-44d9-9946-ef0a76bb3fa8" height="300">  

### 画像の部分一致
事前につけた表面の特徴的な箇所を実験後のデータから切取り、実験前のデータで一致する箇所を探す。この時二つの画像の相互相関が高くなる（つまり最も画像が一致する）部分を求めそれらの座標から画像の位置を補正する。

<img src="https://github.com/user-attachments/assets/eb58a8c0-9542-4d56-92d2-83e7ef5ab4a5" height="300">  

### 画像をマスクする
最小二乗平面を求めるために不要な箇所（実験前後で変化する箇所、画像を一致させるためにつけた特徴的なマーク）をマスクします。

マスクする際には微分フィルターを用いて色の変化の大きいところを抽出するようにし、自動で適切な箇所をマスクできるようにしています。

<img src="https://github.com/user-attachments/assets/86ad69a7-ed20-4a56-9890-73dfceb00375" height="300">  

### 最小二乗平面を求め、補正する。
材料の表面の傾きをマスク後のデータから補正します。

### データの表示
重ね合わせ後のデータは以下のようになります。図中の画像は実験前後で変化した箇所を示しています。黒い箇所が変化した部分です。また２つのグラフは表面の断面を表示したもので青が実験後、オレンジが実験前のデータです。実験前のデータと実験後のデータのデータで変化していない箇所はよく一致していることがわかります。

<img src="https://github.com/user-attachments/assets/fabc834b-2a36-4d3f-9085-584d1df0b075" height="400">  


